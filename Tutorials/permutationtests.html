<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Permutation Tests</title>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>



</head>

<body>
<h1>Permutation Tests</h1>

<p>An increasingly common statistical tool for constructing sampling distributions is the permutation test (or sometimes called a randomization test). Like bootstrapping, a permutation test builds - rather than assumes - sampling distribution (called the &ldquo;permutation distribution&rdquo;) by resampling the observed data.
Specifically, we can &ldquo;shuffle&rdquo; or permute the observed data (e.g., by assigning different outcome values to each observation from among the set of actually observed outcomes). Unlike bootstrapping, we do this without replacement.</p>

<p>Permutation tests are particularly relevant in experimental studies, where we are often interested in the sharp null hypothesis of no difference between treatment groups. In these situations, the permutation test perfectly represents our process of inference because our null hypothesis is that the two treatment groups do not differ on the outcome (i.e., that the outcome is observed independently of treatment assignment). When we permute the outcome values during the test, we therefore see all of the possible alternative treatment assignments we could have had and where the mean-difference in our observed data falls relative to all of the differences we could have seen if the outcome was independent of treatment assignment.
While a permutation test requires that we see all possible permutations of the data (which can become quite large), we can easily conduct &ldquo;approximate permutation tests&rdquo; by simply conducting a vary large number of resamples. That process should, in expectation, approximate the permutation distribution.</p>

<p>For example, if we have only n=20 units in our study, the number of permutations is:</p>

<pre><code class="r">factorial(20)
</code></pre>

<pre><code>## [1] 2.433e+18
</code></pre>

<p>That number exceeds what we can reasonably compute. But we can randomly sample from that permutation distribution to obtain the approximate permutation distribution, simply by running a large number of resamples.
Let&#39;s look at this as an example using some made up data:</p>

<pre><code class="r">set.seed(1)
n &lt;- 100
tr &lt;- rbinom(100, 1, 0.5)
y &lt;- 1 + tr + rnorm(n, 0, 3)
</code></pre>

<p>The difference in means is, as we would expect (given we made it up), about 1:</p>

<pre><code class="r">diff(by(y, tr, mean))
</code></pre>

<pre><code>## [1] 1.341
</code></pre>

<p>To obtain a single permutation of the data, we simply resample without replacement and calculate the difference again:</p>

<pre><code class="r">s &lt;- sample(tr, length(tr), FALSE)
diff(by(y, s, mean))
</code></pre>

<pre><code>## [1] -0.2612
</code></pre>

<p>Here we use the permuted treatment vector <code>s</code> instead of <code>tr</code> to calculate the difference and find a very small difference. If we repeat this process a large number of times, we can build our approximate permutation distribution (i.e., the sampling distribution for the mean-difference).
We&#39;ll use <code>replicate</code> do repeat our permutation process. The result will be a vector of the differences from each permutation (i.e., our distribution):</p>

<pre><code class="r">dist &lt;- replicate(2000, diff(by(y, sample(tr, length(tr), FALSE), mean)))
</code></pre>

<p>We can look at our distribution using <code>hist</code> and draw a vertical line for our observed difference:</p>

<pre><code class="r">hist(dist, xlim = c(-3, 3), col = &quot;black&quot;, breaks = 100)
abline(v = diff(by(y, tr, mean)), col = &quot;blue&quot;, lwd = 2)
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAeFBMVEX9/v0AAAAAADkAAGUAAP8AOTkAOWUAOY8AZo8AZrU5AAA5ADk5AGU5OY85j485j9plAABlADllAGVlOQBlZjlltbVltf2POQCPOTmPtY+P2/21ZgC1/rW1/v3ajzna24/a/rXa/tra/v39tWX924/9/rX9/tr9/v1yGxmIAAAAKHRSTlP///////////////////////////////////////////////////8AvqouGAAAAAlwSFlzAAALEgAACxIB0t1+/AAADU9JREFUeJzt3eli4sgVQOEpuyeOyXRMdxLTMTGZmEXv/4ZRSYAsI7gqlVDd0j3nR2MwAlQf2twsvxVkst9SPwBKE/BGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA32szg98vH96I4rB7f659OrV8jbnS3cA9vzT08fYx428maLXzr4rWLwWlN7eFHvO1kzRa++qlcVt3j+2HlnHsuik158lL4X7vH/5R+h9XDP8tleVteXC7RW/fX8vL38konyPr61dQ1tv/xX6clvn3b2TVr+P3SebT/1Thrf6Y8rax+X3h4/9s/6yt9bN2p4+rieP0GvvrJ/3x52/k1O/iTncfZLY6rZb863i3KxXq/fHjbLUrZjavgn0+TPb5vnZ/Avfqr+MvO1z+vzM8TXtx2hs0avjrnl1+Ps62UN+61+mFfr+rfThN5+OfqCXC69Hz9M+15wovbzrDZwV9s491xmb0GX13nDN88HQT41m1n2LzhfesjXdeq3hNvyh04f9FXeGFV37rtDJs1/Glh9vtpnTt3nnjrupf48/XPtK2du/Zt59es4avV8XF1Xu6KnQ7nys3z6XDOE5dyL8ctQAv+fP3zMu3l//55Vd/cdnbNDL532yy1Rswg/HHP/yX140ibQfh6q57jdnnMLMJTAbzZgDca8EYD3mjAGw14owFvNOCNBrzRgDca8EYD3mjAGw14owFvNOCNBrzRgDca8EYD/r59+5b6EVwJ+PsGvNEyhq/fJOa+fLgI9Stf+MPq+B5h4285Gli+8Puf761TCipfeJb4qPKFP73HkG38oDKGp5hmBX/+XLDRH838yhi+PJx73nSu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" alt="plot of chunk unnamed-chunk-6"/> </p>

<p>At face value, it seems that our null hypothesis can probably be rejected. Our observed mean-difference appears to be quite extreme in terms of the distribution of possible mean-differences observable were the outcome independent of treatment assignment.
But we can use the distribution to obtain a p-value for our mean-difference by counting how many permuted mean-differences are larger than the one we observed in our actual data. We can then divide this by the number of items in our permutation distribution (i.e., 2000 from our call to <code>replicate</code>, above):</p>

<pre><code class="r">sum(dist &gt; diff(by(y, tr, mean)))/2000  # one-tailed test
</code></pre>

<pre><code>## [1] 0.009
</code></pre>

<pre><code class="r">sum(abs(dist) &gt; abs(diff(by(y, tr, mean))))/2000  # two-tailed test
</code></pre>

<pre><code>## [1] 0.018
</code></pre>

<p>Using either the one-tailed test or the two-tailed test, our difference is unlikely to be due to chance variation observable in a world where the outcome is independent of treatment assignment.</p>

<h2>library(coin)</h2>

<p>We don&#39;t always need to build our own permutation distributions (though it is good to know how to do it). R provides a package to conduct permutation tests called <strong>coin</strong>.
We can compare our p-value (and associated inference) from above with the result from <strong>coin</strong>:</p>

<pre><code class="r">library(coin)
independence_test(y ~ tr, alternative = &quot;greater&quot;)  # one-tailed
</code></pre>

<pre><code>## 
##  Asymptotic General Independence Test
## 
## data:  y by tr
## Z = 2.315, p-value = 0.01029
## alternative hypothesis: greater
</code></pre>

<pre><code class="r">independence_test(y ~ tr)  # two-tailed
</code></pre>

<pre><code>## 
##  Asymptotic General Independence Test
## 
## data:  y by tr
## Z = 2.315, p-value = 0.02059
## alternative hypothesis: two.sided
</code></pre>

<p>Clearly, our approximate permutation distribution provided the same inference and a nearly identical p-value.
<strong>coin</strong> provides other permutation tests for different kinds of comparisons, as well. Almost anything that you can address in a parametric framework can also be done in a permutation framework (if substantively appropriate). and anything that <strong>coin</strong> doesn&#39;t provide, you can build by hand with the basic permutation logic of resampling.</p>

</body>

</html>
